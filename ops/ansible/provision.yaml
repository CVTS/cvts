 - hosts: all
   user: root

   tasks:
   - name: Add the user 'ubuntu' with a specific groups
     ansible.builtin.user:
       name: ubuntu
       groups: sudo
       password: "$1$IveBeenA$UlFfzeZc0GDrihfkKvKdY."

   - name: Auth key
     authorized_key: user=ubuntu key="{{ item }}"
     with_file:
       - deploy_keys/jamie.pub

   - name: Disable root login over SSH
     lineinfile: dest=/etc/ssh/sshd_config regexp="^PermitRootLogin" line="PermitRootLogin no" state=present
     notify:
       - restart sshd

   - name: Disable password login
     lineinfile: dest=/etc/ssh/sshd_config regexp="^PasswordAuthentication" line="PasswordAuthentication no" state=present
     notify:
       - restart sshd

   handlers:
   - name: restart sshd
     service:
       name: sshd
       state: restarted



      # - name: Creates data root directory
      #   file:
      #     path: /mnt/kahuna_data
      #     state: directory
      #   become: True

      # - name: Set permissions on hakuna_data mount
      #   file:
      #     path: /mnt/kahuna_data
      #     owner: hakuna
      #     group: hakuna
      #     mode: u=rwx,g=rwx,o=rx,g+s
      #     state: directory
      #   become: yes

      # - name: Apt dependencies
      #   apt:
      #      update_cache: yes
      #      name: pbzip2,htop,tmux,unzip,ntp,ack-grep,silversearcher-ag,python3,python3-pip,build-essential,libssl-dev,python3-dev,git
      #   become: True

      # - name: Install PIP dependencies
      #   pip:
      #      name: jupyter,jupyterlab,numpy,geopandas,schematics,ipyleaflet,psycopg2-binary,matplotlib,seaborn,numpy_financial,intervaltree

      # - name: Copy files
      #   ansible.posix.synchronize:
      #     src: "{{ src_dir }}/{{ item }}"
      #     dest: "/home/ubuntu/cba_poc/"
      #   with_items:
      #     - notebooks
      #     - roads_cba_py
      #     - data
